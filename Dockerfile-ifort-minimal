FROM ubuntu:22.04

# Extend and update the package registry
RUN apt-get update \
 && apt-get --yes install \
      --no-install-recommends \
      ca-certificates \
      curl \
      gpg \
 && curl https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2023.PUB \
      | gpg --dearmor > /usr/share/keyrings/oneapi-archive-keyring.gpg \
 && echo "deb [signed-by=/usr/share/keyrings/oneapi-archive-keyring.gpg] https://apt.repos.intel.com/oneapi all main" > /etc/apt/sources.list.d/oneAPI.list \
 && apt-get update

# Install compilers and build tools
RUN apt-get --yes install \
      --no-install-recommends \
      binutils \
      g++ \
      gcc \
      intel-oneapi-compiler-dpcpp-cpp-and-cpp-classic \
      intel-oneapi-compiler-fortran \
      libc-dev \
      make

# Initialize Intel compiler for login shells
RUN echo ". /opt/intel/oneapi/setvars.sh" >> /etc/profile.d/oneapi.sh

# Set default compiler executables
ENV FC=ifort CC=icc

# Enable Intel compiler for the Dockerfile instructions
SHELL ["/bin/bash", "-lc"]

# Enable Intel compiler for the CLI commands and interactive mode
ENTRYPOINT ["/bin/bash", "-lc", "\"$@\"", "--"]
CMD ["/bin/bash"]
